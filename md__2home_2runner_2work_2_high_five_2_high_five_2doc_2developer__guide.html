<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.11.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HighFive: Developer Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">HighFive<span id="projectnumber">&#160;2.10.1</span>
   </div>
   <div id="projectbrief">HighFive - Header-only C++ HDF5 interface</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.11.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md__2home_2runner_2work_2_high_five_2_high_five_2doc_2developer__guide.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Developer Guide</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>First clone the repository and remember the <code>--recursive</code>: </p><div class="fragment"><div class="line">git clone --recursive git@github.com:BlueBrain/HighFive.git</div>
</div><!-- fragment --><p> The instructions to recover if you forgot are: </p><div class="fragment"><div class="line">git submodule update --init --recursive</div>
</div><!-- fragment --><p>One remark on submodules: each <a class="el" href="namespace_high_five.html">HighFive</a> commit expects that the submodules are at a particular commit. The catch is that performing <code>git checkout</code> will not update the submodules automatically. Hence, sometimes a <code>git submodule update --recursive</code> might be needed to checkout the expected version of the submodules.</p>
<h1>Compiling and Running the Tests</h1>
<p>The instructions for compiling with examples and unit-tests are:</p>
<div class="fragment"><div class="line">cmake -B build -DCMAKE_BUILD_TYPE={Debug,Release} .</div>
<div class="line">cmake --build build --parallel</div>
<div class="line">ctest --test-dir build</div>
</div><!-- fragment --><p>You might want to turn off Boost <code>-DHIGHFIVE_USE_BOOST=Off</code> or turn on other optional dependencies.</p>
<h1>Contributing</h1>
<p>There's numerous HDF5 features that haven't been wrapped yet. <a class="el" href="namespace_high_five.html">HighFive</a> is a collaborative effort to slowly cover ever larger parts of the HDF5 library. The process of contributing is to fork the repository and then create a PR. Please ensure that any new API is appropriately documented and covered with tests.</p>
<h2>Code formatting</h2>
<p>The project is formatted using clang-format version 12.0.1 and CI will complain if a commit isn't formatted accordingly. The <code>.clang-format</code> is at the root of the git repository. Conveniently, <code>clang-format</code> is available via <code>pip</code>:</p>
<div class="fragment"><div class="line">python -m venv venv</div>
<div class="line">source venv/bin/activate</div>
<div class="line"> </div>
<div class="line">pip install clang-format==12.0.1</div>
</div><!-- fragment --><p>The changed lines can be formatted with <code>git-clang-format</code>, e.g. to format all lines changed compared to master:</p>
<div class="fragment"><div class="line">git-clang-format master</div>
</div><!-- fragment --><p> (add <code>-f</code> to allow formatting unstaged changes if you trust it to not destroy your changes.)</p>
<h1>Releasing <a class="el" href="namespace_high_five.html">HighFive</a></h1>
<p>Before releasing a new version perform the following:</p>
<ul>
<li>Update <code><a class="el" href="_c_h_a_n_g_e_l_o_g_8md.html">CHANGELOG.md</a></code> and <code>AUTHORS.txt</code> as required.</li>
<li>Update <code>CMakeLists.txt</code> and <code><a class="el" href="_h5_version_8hpp.html">include/highfive/H5Version.hpp</a></code>.</li>
<li>Follow semantic versioning when deciding the next version number.</li>
<li>Check that <a href="https://github.com/BlueBrain/HighFive-testing/actions">HighFive-testing</a> ran recently.</li>
</ul>
<p>At this point there should be a commit on master which will be the release candidate. Don't tag it yet.</p>
<p>Next step is to update the <a href="https://github.com/BlueBrain/spack">HighFive/spack</a> recipe such that the proposed version points to the release candidate using the SHA of that commit. The recipe will look something like this:</p>
<div class="fragment"><div class="line"><span class="comment"># ...</span></div>
<div class="line"> </div>
<div class="line">version(<span class="stringliteral">&quot;2.8.0&quot;</span>, commit=<span class="stringliteral">&quot;094400f22145bcdcd2726ce72888d9d1c21e7068&quot;</span>)</div>
<div class="line">version(<span class="stringliteral">&quot;2.7.1&quot;</span>, sha256=<span class="stringliteral">&quot;25b4c51a94d1e670dc93b9b73f51e79b65d8ff49bcd6e5d5582d5ecd2789a249&quot;</span>)</div>
<div class="line">version(<span class="stringliteral">&quot;2.7.0&quot;</span>, sha256=<span class="stringliteral">&quot;8e05672ddf81a59ce014b1d065bd9a8c5034dbd91a5c2578e805ef880afa5907&quot;</span>)</div>
<div class="line"><span class="comment"># ...</span></div>
</div><!-- fragment --><p>Push the changes to the BlueBrain spack repository. This will trigger building all BBP dependencies of <a class="el" href="namespace_high_five.html">HighFive</a>, i.e. another integration test. Don't actually merge this commit yet.</p>
<p>Now that we know that the integration test ran, and all BBP software can be built with the proposed version of <a class="el" href="namespace_high_five.html">HighFive</a>, we can proceed and create the release. Once this is done perform a final round of updates:</p>
<ul>
<li>Download the archive (<code>*.tar.gz</code>) and compute its SHA256.</li>
<li>Update BlueBrain Spack recipe to use the archive and not the Git commit.</li>
<li>Update the upstream Spack recipe.</li>
</ul>
<h1>Writing Tests</h1>
<h2>Generate Multi-Dimensional Test Data</h2>
<p>Input array of any dimension and type can be generated using the template class <code>DataGenerator</code>. For example: </p><div class="fragment"><div class="line">auto dims = std::vector&lt;size_t&gt;{4, 2};</div>
<div class="line">auto values = testing::DataGenerator&lt;std::vector&lt;std::array&lt;double, 2&gt;&gt;::create(dims);</div>
</div><!-- fragment --><p> Generates an <code>std::vector&lt;std::array&lt;double, 2&gt;&gt;</code> initialized with suitable values.</p>
<p>If "suitable" isn't specific enough, one can specify a callback: </p><div class="fragment"><div class="line">auto callback = [](const std::vector&lt;size_t&gt;&amp; indices) {</div>
<div class="line">    return 42.0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">auto values = testing::DataGenerator&lt;std::vector&lt;double&gt;&gt;::create(dims, callback);</div>
</div><!-- fragment --><p>The <code>dims</code> can be generated via <code>testing::DataGenerator::default_dims</code> or by using <code>testing::DataGenerator::sanitize_dims</code>. Remember, that certain containers are fixed size and that we often compute the number of elements by multiplying the dims.</p>
<h2>Generate Scalar Test Data</h2>
<p>To generate a single "suitable" element use template class <code>DefaultValues</code>, e.g. </p><div class="fragment"><div class="line">auto default_values = testing::DefaultValues&lt;double&gt;();</div>
<div class="line">auto x = testing::DefaultValues&lt;double&gt;(indices);</div>
</div><!-- fragment --><h2>Accessing Elements</h2>
<p>To access a particular element from an unknown container use the following trait: </p><div class="fragment"><div class="line">using trait = testing::ContainerTraits&lt;std::vector&lt;std::array&lt;int, 2&gt;&gt;;</div>
<div class="line">// auto x = values[1][0];</div>
<div class="line">auto x = trait::get(values, {1, 0});</div>
<div class="line"> </div>
<div class="line">// values[1][0] = 42.0;</div>
<div class="line">trait::set(values, {1, 0}, 42.0);</div>
</div><!-- fragment --><h2>Utilities For Multi-Dimensional Arrays</h2>
<p>Use <code>testing::DataGenerator::allocate</code> to allocate an array (without filling it) and <code>testing::copy</code> to copy an array from one type to another. There's <code>testing::ravel</code>, <code>testing::unravel</code> and <code>testing::flat_size</code> to compute the position in a flat array from a multi-dimensional index, the reverse and the number of element in the multi-dimensional array.</p>
<h2>Deduplicating DataSet and Attribute</h2>
<p>Due to how <a class="el" href="namespace_high_five.html">HighFive</a> is written testing <code>DataSet</code> and <code>Attribute</code> often requires duplicating the entire test code because somewhere a <code>createDataSet</code> must be replaced with <code>createAttribute</code>. Use <code>testing::AttributeCreateTraits</code> and <code>testing::DataSetCreateTraits</code>. For example, </p><div class="fragment"><div class="line">template&lt;class CreateTraits&gt;</div>
<div class="line">void check_write(...) {</div>
<div class="line">    // Same as one of:</div>
<div class="line">    //   file.createDataSet(name, values);</div>
<div class="line">    //   file.createAttribute(name, values);</div>
<div class="line">    CreateTraits::create(file, name, values);</div>
<div class="line">}</div>
</div><!-- fragment --><h2>Test Organization</h2>
<h3>Multi-Dimensional Arrays</h3>
<p>All tests for reading/writing whole multi-dimensional arrays to datasets or attributes belong in <code>tests/unit/tests_high_five_multi_dimensional.cpp</code>. This includes write/read cycles; checking all the generic edges cases, e.g. empty arrays and mismatching sizes; and checking non-reallocation.</p>
<p>Read/Write cycles are implemented in two distinct checks. One for writing and another for reading. When checking writing we read with a "trusted" multi-dimensional array (a nested <code>std::vector</code>), and vice-versa when checking reading. This matters because certain bugs, like writing a column major array as if it were row-major can't be caught if one reads it back into a column-major array.</p>
<p>Remember, <code>std::vector&lt;bool&gt;</code> is very different from all other <code>std::vector</code>s.</p>
<p>Every container <code>template&lt;class T&gt; C;</code> should at least be checked with all of the following <code>T</code>s that are supported by the container: <code>bool</code>, <code>double</code>, <code>std::string</code>, <code>std::vector</code>, <code>std::array</code>. The reason is <code>bool</code> and <code>std::string</code> are special, <code>double</code> is just a POD, <code>std::vector</code> requires dynamic memory allocation and <code>std::array</code> is statically allocated.</p>
<p>Similarly, each container should be put inside an <code>std::vector</code> and an <code>std::array</code>.</p>
<h3>Scalar Data Set</h3>
<p>Write-read cycles for scalar values should be implemented in <code>tests/unit/tests_high_five_scalar.cpp</code>.</p>
<h3>Data Types</h3>
<p>Unit-tests related to checking that <code>DataType</code> API, go in <code>tests/unit/tests_high_data_type.cpp</code>.</p>
<h3>Selections</h3>
<p>Anything selection related goes in <code>tests/unit/test_high_five_selection.cpp</code>. This includes things like <code>ElementSet</code> and <code>HyperSlab</code>.</p>
<h3>Strings</h3>
<p>Regular write-read cycles for strings are performed along with the other types, see above. This should cover compatibility of <code>std::string</code> with all containers. However, additional testing is required, e.g. character set, padding, fixed vs. variable length. These all go in <code>tests/unit/test_high_five_string.cpp</code>.</p>
<h3>Specific Tests For Optional Containers</h3>
<p>If containers, e.g. <code>Eigen::Matrix</code> require special checks those go in files called <code>tests/unit/test_high_five_*.cpp</code> where <code>*</code> is <code>eigen</code> for Eigen.</p>
<h3>Memory Layout Assumptions</h3>
<p>In <a class="el" href="namespace_high_five.html">HighFive</a> we make assumptions about the memory layout of certain types. For example, we assume that </p><div class="fragment"><div class="line">auto array = std::vector&lt;std::array&lt;double, 2&gt;&gt;(n);</div>
<div class="line">doube * ptr = (double*) array.data();</div>
</div><!-- fragment --><p> is a sensible thing to do. We assume similar about <code>bool</code> and <code>details::Boolean</code>. These types of tests go into <code>tests/unit/tests_high_five_memory_layout.cpp</code>.</p>
<h3><a class="el" href="namespace_h5_easy.html">H5Easy</a></h3>
<p>Anything <code><a class="el" href="namespace_h5_easy.html">H5Easy</a></code> related goes in files with the appropriate name.</p>
<h3>Everything Else</h3>
<p>What's left goes in <code>tests/unit/test_high_five_base.cpp</code>. This covers opening files, groups, dataset or attributes; checking certain pathological edge cases; etc. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.11.0 </li>
  </ul>
</div>
</body>
</html>
